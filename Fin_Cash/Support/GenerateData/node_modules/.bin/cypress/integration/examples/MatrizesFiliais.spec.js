it("Cria matrizes e filiais", function() {        
    cy.visit("https://en.wikipedia.org/wiki/List_of_largest_cities").then(
      () => {
        cy.wait(500).then(() => {
            cy.get('.wikitable > tbody > tr').then(            
                elem => {                                             
                    cy.CreateArray(0, elem.length, [], []);
                }
            )
        });
      }
    );
  });

Cypress.Commands.add('CreateArray', (i, length, arrMatriz, arrFilial) => {
    const filiais = [
        'North',
        'South',
        'West',
        'East',
        'Center'
    ]
    if (i < length) {        
        cy.get('.wikitable > tbody > tr').eq(i).find('td').eq(0).then(
            e => {                                                                                      
                var obj = {
                    id: i + 1,
                    name: e[0].innerText
                };
                arrMatriz.push(obj);
                for(var j = 0; j < filiais.length; j++)
                {                    
                    var objFilial = {
                        id: ((i * filiais.length) + j) + 1,
                        name: e[0].innerText + " - " + filiais[j]
                    };
                    arrFilial.push(objFilial);   
                    console.log((((i * filiais.length) + j) + 1));                 
                }                                                
            }            
        );
        cy.writeFile('Matriz.json', arrMatriz);
        cy.writeFile('Filial.json', arrFilial);
        cy.CreateArray(i + 1, length, arrMatriz, arrFilial);
    }
    else
    {                
        console.log("Process ended");
    }
})